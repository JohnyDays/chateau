#!/usr/bin/env node

var argv = require('optimist').argv,
    path = require('path'),
    fs = require('fs');

if (argv.h || argv.help) {
    console.log([
    "usage: chateau [options]",
    "",
    "options:",
    "  -f [config_file]        Default file: config.js",
    "  -p [database_port]      Default port: 28015",
    "  --host [database_host]  Default host: localhost",
    "  -h                      Shows this help",
    ].join('\n'));
    process.exit();
}

var configFile = path.resolve(argv.f || 'config.js');
var databasePort = argv.p;
var databaseHost = argv.host;

if(!fs.existsSync(configFile))
{
    console.warn('Warning:','Configuration file does not exists. Using default one instead.');
    configFile = path.resolve(__dirname, '../', 'config.template.js');
}

configFile = require(configFile);
if(databasePort != null){
    configFile.port = databasePort;
}
if(databaseHost != null){
    configFile.host = databaseHost;
}
require('../app.js')(configFile);
